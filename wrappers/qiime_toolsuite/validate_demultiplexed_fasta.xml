<?xml version="1.0" ?>
<tool id="validate_demultiplexed_fasta" name="validate demultiplexed fasta" version="1.7.0">
	<description>Checks a fasta file to verify if it has  been properly demultiplexed, i.e., it is in QIIME compatible format.</description>
	<requirements>
		<requirement type="package">qiime</requirement>
	</requirements>
	<command>validate_demultiplexed_fasta.py -m $mapping_fp -i $input_fasta_fp -o validate_demultiplexed_fasta_output
#if str($tree_fp) != 'None':
 -t $tree_fp
#end if

#if $tree_subset:
 -s
#end if

#if $tree_exact_match:
 -e
#end if

#if $same_seq_lens:
 -l
#end if

#if $all_ids_found:
 -a
#end if
;
compress_path.py -i validate_demultiplexed_fasta_output -o $output_dir
</command>
	<inputs>
		<param label="-m/--mapping_fp: name of mapping file. NOTE: Must contain a header line indicating SampleID in the first column and BarcodeSequence in the second, LinkerPrimerSequence in the third.  If no barcode or  linkerprimer sequence is present, leave data fields empty." name="mapping_fp" optional="False" type="data"/>
		<param label="-i/--input_fasta_fp: path to the input fasta file" name="input_fasta_fp" optional="False" type="data"/>
		<param default="None" label="-t/--tree_fp: path to the tree file; Needed to test if sequence IDs are a subset or exact match to the tree tips, options -s and -e  [default: None]" name="tree_fp" optional="True" type="data"/>
		<param label="-s/--tree_subset: Determine if sequence IDs are a subset of the tree tips, newick tree must be passed with the -t option. [default: False]" name="tree_subset" selected="False" type="boolean"/>
		<param label="-e/--tree_exact_match: Determine if sequence IDs are an exact match to tree tips, newick tree must be passed with the -t option. [default: False]" name="tree_exact_match" selected="False" type="boolean"/>
		<param label="-l/--same_seq_lens: Determine if sequences are all the same length. [default: False]" name="same_seq_lens" selected="False" type="boolean"/>
		<param label="-a/--all_ids_found: Determine if all SampleIDs provided in the mapping file are represented in the fasta file labels. [default: False]" name="all_ids_found" selected="False" type="boolean"/>
	</inputs>
	<outputs>
		<data format="tgz" name="output_dir"/>
	</outputs>
	<help>Checks file is a valid fasta file, does not contain gaps ('.' or '-' characters), contains only valid nucleotide characters, no fasta label is duplicated, SampleIDs match those in a provided mapping file, fasta labels are formatted to have SampleID_X as normally generated by QIIME demultiplexing, and the BarcodeSequence/LinkerPrimerSequences are not found in the fasta sequences.  Optionally this script can also verify that the SampleIDs in the fasta sequences are also present in the tip IDs of a provided newick tree file, can test for equal sequence lengths across all sequences, and can test that all SampleIDs in the mapping file are represented in the fasta file labels.
</help>
</tool>
