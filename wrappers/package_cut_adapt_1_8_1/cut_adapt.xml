<tool id="cutadapt" name="cutadapt" version="1.0">
	<requirements>
		<requirement type="package" version="1.8.1">cutadapt</requirement>
	</requirements>
	<description>Cut Adapt Tool</description>
		<command>
			cutadapt
				#for $i in $pair_cond.format_cond.adapters_read1 :
					#if $i.adaptor_cond.first_adaptor_select == "1":
						-a $i.first_adaptor
					#end if
					#if $i.adaptor_cond.first_adaptor_select == "2":
						-g $i.first_adaptor
					#end if	
					#if $i.adaptor_cond.first_adaptor_select == "3":
						-a $i.first_adaptor\$
					#end if	
					#if $i.adaptor_cond.first_adaptor_select == "4":
						-g ^$i.first_adaptor
					#end if	
					#if $i.adaptor_cond.first_adaptor_select == "5":
						-b $i.first_adaptor
					#end if
				#end for				
				#if $pair_cond.pair_select == "1":
					#for $i in $pair_cond.format_cond.adapters_read2:
						#if $i.sec_adaptor_cond.second_adaptor_select == "1":
							-A $i.second_adaptor
						#end if
						#if $i.sec_adaptor_cond.second_adaptor_select == "2":
							-G $i.second_adaptor
						#end if
						#if $i.sec_adaptor_cond.second_adaptor_select == "3":
							-A $i.second_adaptor\$
						#end if	
						#if $i.sec_adaptor_cond.second_adaptor_select == "4":
							-G ^$i.second_adaptor
						#end if
						#if $i.sec_adaptor_cond.second_adaptor_select == "5":
							-B $i.second_adaptor
						#end if
					#end for
					-U $pair_cond.format_cond.second_cut
				#end if
				
				-u $first_cut
				-e $error_tol
				
				#if $quality.quality_select == "1":
					-q $quality.q
				#end if
				
				#if $no_indels == "true":
					--no-indels
				#end if
				-n $times
				-m $min
				#if $max_cond.max_select == "1":
					-M $max_cond.max
				#end if
				
				-O $length
				
				#if $wild_cond.wild_select == "1":
					--match-read-wildcards
				#end if
				
				#if $trim_n_cond.trim_n_select == "1":
					--trim-n
				#end if
				
				#if $max_n_cond.max_n_select == "1":
					--max-n=$max_n_cond.m
				#end if
				
				#if $mask_cond.mask_select == "1":
					--mask-adapter
				#end if
				
				#if $discard_cond.discard_select == "1":
					--discard
				#end if
				
				#if $discard_untrimmed_cond.discard_untrimmed_select == "1":
					--discard-untrimmed
				#end if
				
				#if $pair_cond.format_cond.format_select == "2":
					-f fastq
				#end if
				
				#if $pair_cond.format_cond.format_select == "1":
					-f fasta
				#end if
				
				$pair_cond.format_cond.file1
				
				-o $output1
				
				#if $pair_cond.pair_select == "1":
					-p $output2
				#end if
				
				#if $pair_cond.pair_select == "1":
					$pair_cond.format_cond.file2
				#end if
				> $log
		</command>
		<inputs>
			<conditional name="pair_cond">
				<param name="pair_select" type="select" value="2" label="Do you want to enter end paired files ?">
					<option value="2">No</option>
					<option value="1">Yes</option>
				</param>
				<when value="2">
					<conditional name="format_cond">
						<param name="format_select" type="select" value="2" label="Select the input files format:">
							<option value="2">Fastq</option>
							<option value="1">Fasta</option>
						</param>
						<when value="1">
							<param name="file1" type="data" format='fasta'/>
							<repeat name="adapters_read1" title="The adapters for the first reads file" min="1"  >
								<conditional name="adaptor_cond" >
									<param name="first_adaptor_select" type="select" label="What adaptor type should be used ?">
										<option value="1">3'</option>
										<option value="2">5'</option>
										<option value="3">3' anchored</option>
										<option value="4">5' anchored</option>
										<option value="5">3' or 5'</option>
									</param>
									<when value="1">
									
									</when>
								</conditional>
								<param name="first_adaptor" type="text" label="The first adaptor"/>
							</repeat>
						</when>
						<when value="2">
							<param name="file1" type="data" format='fastq'/>
							<repeat name="adapters_read1" title="The adapters for the first reads file" min="1"  >
								<conditional name="adaptor_cond" >
									<param name="first_adaptor_select" type="select" label="What adaptor type should be used ?">
										<option value="1">3'</option>
										<option value="2">5'</option>
										<option value="3">3' anchored</option>
										<option value="4">5' anchored</option>
										<option value="5">3' or 5'</option>
									</param>
									<when value="1">
									
									</when>
								</conditional>
								<param name="first_adaptor" type="text" label="The first adaptor"/>
							</repeat>
							<param name="second_cut" type="text" value="0" label="Remove bases from the beginning or end of the second read. This is done before any adapter trimming. A positive number will remove bases from the beginning and a negative number will remove the bases from the end."/>
						</when>
					</conditional>
				</when>
				<when value="1">
					<conditional name="format_cond">
						<param name="format_select" type="select" value="2" label="Select the input files format:">
							<option value="2">Fastq</option>
							<option value="1">Fasta</option>
						</param>
						<when value="1">
							<param name="file1" type="data" format='fasta'/>
							<repeat name="adapters_read1" title="The adapters for the first reads file" min="1"  >
								<conditional name="adaptor_cond" >
									<param name="first_adaptor_select" type="select" label="What adaptor type should be used ?">
										<option value="1">3'</option>
										<option value="2">5'</option>
										<option value="3">3' anchored</option>
										<option value="4">5' anchored</option>
										<option value="5">3' or 5'</option>
									</param>
									<when value="1">
									
									</when>
								</conditional>
								<param name="first_adaptor" type="text" label="The first adaptor"/>
							</repeat>
							
							
							<param name="second_cut" type="text" value="0" label="Remove bases from the beginning or end of the second read. This is done before any adapter trimming. A positive number will remove bases from the beginning and a negative number will remove the bases from the end."/>
								<repeat name="adapters_read2" title="The adapters for the second reads file" min="1"  >		
									<conditional name="sec_adaptor_cond" >
										<param name="second_adaptor_select" type="select" label="What adaptor type should be used ?">
											<option value="1">3'</option>
											<option value="2">5'</option>
											<option value="3">3' anchored</option>
											<option value="4">5' anchored</option>
											<option value="5">3' or 5'</option>
										</param>
										<when value="1">
											
										</when>		
									</conditional>
									<param name="second_adaptor" type="text" label="The second adaptor"/>
								</repeat>
								<param name="file2" type="data" format='FASTA'/>
						</when>
						<when value="2">
							<param name="file1" type="data" format='fastq'/>
							<repeat name="adapters_read1" title="The adapters for the first reads file" min="1"  >
								<conditional name="adaptor_cond" >
									<param name="first_adaptor_select" type="select" label="What adaptor type should be used ?">
										<option value="1">3'</option>
										<option value="2">5'</option>
										<option value="3">3' anchored</option>
										<option value="4">5' anchored</option>
										<option value="5">3' or 5'</option>
									</param>
									<when value="1">
									
									</when>
								</conditional>
								<param name="first_adaptor" type="text" label="The first adaptor"/>
							</repeat>
							<param name="second_cut" type="text" value="0" label="Remove bases from the beginning or end of the second read. This is done before any adapter trimming. A positive number will remove bases from the beginning and a negative number will remove the bases from the end."/>
							<repeat name="adapters_read2" title="The adapters for the second reads file" min="1"  >		
								<conditional name="sec_adaptor_cond" >
									<param name="second_adaptor_select" type="select" label="What adaptor type should be used ?">
										<option value="1">3'</option>
										<option value="2">5'</option>
										<option value="3">3' anchored</option>
										<option value="4">5' anchored</option>
										<option value="5">3' or 5'</option>
									</param>
									<when value="1">
										
									</when>
								</conditional>
									<param name="second_adaptor" type="text" label="The second adaptor"/>
							</repeat>
							<param name="file2" type="data" format='fastq'/>
						</when>
					</conditional>
				</when>
			</conditional>
			
			<param name="first_cut" type="text" value="0" label="Remove bases from the beginning or end of the first read. This is done before any adapter trimming. A positive number will remove bases from the beginning and a negative number will remove the bases from the end."/>
			<param name="error_tol" type="text" value="0.1" label="Enter the desired error tolerance for the searches for adapter sequences. The default is 0.1"/>
			<conditional name="quality">
				<param name="quality_select" type="select" label="Do you want to trim low-quality ends from reads before adapter removal.">
					<option value="1">Yes</option>
					<option value="2">No</option>
				</param>
				<when value="1">
					<param name="q" type="text" value="" label="OFF, --quality-cutoff=[5'CUTOFF,]3'CUTOFF. Trim low-quality bases from 5' and/or 3' ends of reads before adapter removal. If one value is given, only the 3' end is trimmed. If two comma-separated cutoffs are given, the 5' end is trimmed with the first cutoff, the 3' end with the second."/>
				</when>
			</conditional>
			
			<param name="no_indels" type="boolean" value="false" label="Do not allow allow indels in alignments. (Only allowed for anchored adapters.) (Default allow both mismatches and indels)"/>
			<param name="times" type="text" value="1" label="How many times at most should it be attempted to remove an adapter ?"/>
			<param name="length" type="text" value="3" label="The minimum overlap length. If the overlap between the read and the adapter is shorter than length, the read is not modified by default 3"/>
			
			<conditional name="wild_cond">
				<param name="wild_select" type="select" value="2" label="Do you want to allow IUPAC wildcards in reads?">
					<option value="2">No</option>
					<option value="1">Yes</option>
				</param>
				<when value="1">
				</when>
			</conditional>
			<conditional name="trim_n_cond">
				<param name="trim_n_select" type="select" value="2" label="Do you want to trim N's on the ends of reads?">
					<option value="2">No</option>
					<option value="1">Yes</option>
				</param>
				<when value="1">
				</when>
			</conditional>
			<conditional name="max_n_cond">
				<param name="max_n_select" type="select" value="2" label="Do you provide a maximum number of N's allowed in a read?">
					<option value="2">No</option>
					<option value="1">Yes</option>
				</param>
				<when value="1">
					<param name="m" type="text" value="1" label="A number less than 1 will be treated as a proportion while numbers greater than 1 will be treated as a maximum number of N's contained."/>
				</when>
			</conditional>	
			<conditional name="mask_cond">
				<param name="mask_select" type="select" value="2" label="Do you to mask adapters with 'N' characters instead of trimming them ?">
					<option value="2">No</option>
					<option value="1">Yes</option>
				</param>
				<when value="1">
				</when>
			</conditional>
			
			<conditional name="discard_cond">
				<param name="discard_select" type="select" value="2" label="Do you want to discard reads thst contain the adapter instead of trimming them ?.">
					<option value="2">No</option>
					<option value="1">Yes</option>
				</param>
			</conditional>
			
			<conditional name="discard_untrimmed_cond">
				<param name="discard_untrimmed_select" type="select" value="2" label="Do you want to discard reads thst do not contain the adapter instead of trimming them ?.">
					<option value="2">No</option>
					<option value="1">Yes</option>
				</param>
			</conditional>
			
			<param name="min" type="text" value="0" label="Discard all trimmed reads that are shorter then the provided value."/>
			
			<conditional name="max_cond">
				<param name="max_select" type="select" value="2" label="Do you want to discard trim reads longer then a certain value?">
					<option value="2">No</option>
					<option value="1">Yes</option>
				</param>
				<when value="1">
					<param name="max" type="text" value="100" label="Enter the desired maximum for the length of trimmed reads."/>
				</when>
			</conditional>
			
		</inputs>
		<outputs>
			<data format="txt" name="output1" label="First trimmed reads"/>
			<data format="txt" name="output2" label="Second trimmed reads">
				<filter>pair_cond['pair_select'] == "1"</filter>
			</data>
			<data format="txt" name="log" label="Cut Adapt Log file"/>
		</outputs>
		<help>
			Cutting the adapts
		</help>
</tool>
